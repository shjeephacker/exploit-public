#include <linux/init.h>
#include <linux/module.h>
#include <linux/kernel.h>
#include <linux/proc_fs.h>

void (*my_funptr)(void);

ssize_t bug1_write(struct file *file, const char *buf, size_t len, loff_t *off)
{
  printk("null thread info:task->stack: %p\n", current->stack);
    my_funptr();
    return len;
}

const struct file_operations fops = {
	.write = bug1_write,
};

static int __init null_dereference_init(void)
{
    printk(KERN_ALERT "null_dereference driver init!\n");
    proc_create("bug1", 0666, 0, &fops);
    return 0;
}

static void __exit null_dereference_exit(void)
{
    printk(KERN_ALERT "null_dereference driver exit\n");
}

module_init(null_dereference_init);
module_exit(null_dereference_exit);
MODULE_LICENSE("GPL");
